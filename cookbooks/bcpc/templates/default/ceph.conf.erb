################################################
#
#              Generated by Chef
#
################################################

[global]
    fsid = <%=get_config('ceph-fs-uuid')%>
    auth supported = cephx
    public network = <%= @node["bcpc"]["storage"]["cidr"] %>
    cluster network = <%= @node["bcpc"]["storage"]["cidr"] %>
    keyring = /etc/ceph/$cluster.$name.keyring
    mon host = <%= @servers.map{|s| s["bcpc"]["storage"]["ip"] + ":6789"}.join(', ') %>
    rgw socket path = /var/lib/ceph/radosgw/rgw_fcgi.sock
<% if @node["bcpc"]["ceph"]["rebalance"] %> 
    paxos_propose_interval = 60 
<% end %>

[mon]
    keyring = /var/lib/ceph/mon/$cluster-$id/keyring
    debug paxos = 0/5

[mds]
    keyring = /var/lib/ceph/mds/$cluster-$id/keyring

[osd]
    keyring = /var/lib/ceph/osd/$cluster-$id/keyring
    osd journal size = 1024
    filestore_xattr_use_omap = true
    osd_fs_type = xfs
    osd_fs_mount_options_xfs = noexec,nodev,noatime,nodiratime,barrier=0,discard
    osd_crush_update_on_start = false
    osd_client_op_priority = 63 
<% if @node["bcpc"]["ceph"]["rebalance"] %> 
    osd_recovery_max_active = 1
    osd_max_backfills  = 1
    osd_op_threads = 10    
    osd_recovery_op_priority = 1
    osd_mon_report_interval_min = 30         
<% end %>

[client.radosgw.gateway]
    keyring = /var/lib/ceph/radosgw/$cluster-$id/keyring
    log file = /var/log/ceph/radosgw.log
    rgw enable ops log = false
    rgw enable usage log = false
    debug rgw = 0/0
    rgw keystone url = <%=node['bcpc']['management']['vip']%>:35358
    rgw keystone admin token = <%=get_config('keystone-admin-token')%>
    rgw keystone accepted roles = admin Member _member_
    rgw keystone token cache size = 1000
    rgw keystone revocation interval = 1200
    rgw s3 auth use keystone = true
    rgw dns name = s3.<%=node['bcpc']['domain_name'] %>
